apiVersion: v1
kind: Service
metadata:
  name: savemypodo-app-service
spec:
  selector:
    app.kubernetes.io/name: savemypodo-app
  type: ClusterIP
  ports:
    - protocol: TCP
      port: 8080
      targetPort: 8080

---

apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: argocd-app-ingress
  annotations:
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/target-type: ip
    alb.ingress.kubernetes.io/listen-ports: '[{"HTTPS": 443}]'
    alb.ingress.kubernetes.io/certificate-arn: arn:aws:acm:region:account-id:certificate/your-cert-id # ACM 인증서 ARN을 여기에 입력!!
    external-dns.alpha.kubernetes.io/hostname: api.savemypodo.shop
    alb.ingress.kubernetes.io/backend-protocol: HTTP
spec:
  ingressClassName: alb
  rules:
    - host: api.savemypodo.shop
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: savemypodo-app-service
                port:
                  number: 8080
  tls:
    - hosts:
        - api.savemypodo.shop
      secretName: dummy-placeholder  # ALB는 ACM 사용하므로 실제로는 사용되지 않음

---

apiVersion: apps/v1
kind: Deployment
metadata:
  name: savemypodo-app-deployment
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: savemypodo-app
  template:
    metadata:
      labels:
        app.kubernetes.io/name: savemypodo-app
    spec:
      containers:
      - name: savemypodo-app-container
        image: cjsqudwns/savemypodo-be:latest
        ports:
        - protocol: TCP
          containerPort: 8080
        # env:
        # - name: SPRING_DATASOURCE_URL
        #   value: jdbc:mysql://savemypodo-mysql.c3qme6c6e7fj.ap-northeast-2.rds.amazonaws.com:3306/savemypodo
        # - name: SPRING_DATASOURCE_USERNAME
        #   valueFrom:
        #     secretKeyRef:
        #       name: rds-secret
        #       key: MYSQL_USER
        # - name: SPRING_DATASOURCE_PASSWORD
        #   valueFrom:
        #     secretKeyRef:
        #       name: rds-secret
        #       key: MYSQL_PASSWORD