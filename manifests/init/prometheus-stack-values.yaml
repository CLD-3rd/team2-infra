prometheus:
  prometheusSpec:
    # ë¦¬ì†ŒìŠ¤ ì œí•œ ì„¤ì •
    resources:
      requests:
        memory: 400Mi
        cpu: 100m
      limits:
        memory: 2Gi
        cpu: 1000m
    
    # ë°ì´í„° ë³´ì¡´ ê¸°ê°„
    retention: 15d
    
    # ìŠ¤í† ë¦¬ì§€ ì„¤ì •
    storageSpec:
      volumeClaimTemplate:
        spec:
          storageClassName: gp2
          accessModes: ["ReadWriteOnce"]
          resources:
            requests:
              storage: 5Gi
    
    # ì„œë¹„ìŠ¤ ëª¨ë‹ˆí„° ì…€ë ‰í„° ì„¤ì •
    # HelmValuesì— ìˆëŠ”ê²ƒë§Œ í•˜ì§€ ì•Šê³  ì¶”ê°€ì ìœ¼ë¡œ ì„ íƒí•˜ê² ë‹¤.
    serviceMonitorSelectorNilUsesHelmValues: false
    podMonitorSelectorNilUsesHelmValues: false
    
    # ì¶”ê°€ ìŠ¤í¬ë© ì„¤ì •
    additionalScrapeConfigs:
    - job_name: 'kubernetes-pods'
      kubernetes_sd_configs:
      - role: pod
        namespaces:
          names:
          - default
          - dev
          - prod
      relabel_configs:
      - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape]
        action: keep
        regex: true
      metrics_path: /actuator/prometheus

    additionalPrometheusRules:  # ğŸ‘ˆ ì—¬ê¸° ì¶”ê°€!
      - name: basic-alert-rules
        groups:
          - name: example-alert-group
            rules:
              - alert: PodNotRunning
                expr: kube_pod_status_phase{phase="Running"} == 0
                for: 1m
                labels:
                  severity: warning
                annotations:
                  summary: "Pod is not running"
                  description: "No pods are in Running phase."
                  
  
  service:
    type: LoadBalancer
    annotations:
      external-dns.alpha.kubernetes.io/hostname: prometheus.savemypodo.shop
      service.beta.kubernetes.io/aws-load-balancer-scheme: internal

grafana:
  
  # ì„œë¹„ìŠ¤ íƒ€ì… ì„¤ì •
  service:
    type: LoadBalancer
    annotations:
      external-dns.alpha.kubernetes.io/hostname: grafana.savemypodo.shop
      service.beta.kubernetes.io/aws-load-balancer-scheme: internal

  # ë¦¬ì†ŒìŠ¤ ì„¤ì •
  resources:
    limits:
      cpu: 200m
      memory: 256Mi
    requests:
      cpu: 100m
      memory: 128Mi
  
  # ì˜êµ¬ ìŠ¤í† ë¦¬ì§€
  persistence:
    enabled: true
    storageClassName: gp2 # EKSì˜ ê¸°ë³¸ ìŠ¤í† ë¦¬ì§€ í´ë˜ìŠ¤ ì‚¬ìš©
    accessModes:
      - ReadWriteOnce
    size: 5Gi

alertmanager:
  config:
    global:
      smtp_smarthost: 'smtp.gmail.com:587'
      smtp_from: 'michelle200323@gmail.com'
      smtp_auth_username: 'michelle200323'
      smtp_auth_password: 'mvyoÂ cvypÂ ffpgÂ pzwn'
    route:
      group_by: ['alertname']
      group_wait: 10s
      group_interval: 30s
      repeat_interval: 1h
      receiver: 'email-notify'
    receivers:
      - name: 'email-notify'
        email_configs:
          - to: 'michelle200323@gmail.com'


# Node Exporter ì„¤ì •
nodeExporter:
  enabled: true

# Kube State Metrics ì„¤ì •
kubeStateMetrics:
  enabled: true
