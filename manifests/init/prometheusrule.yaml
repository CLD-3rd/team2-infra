apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: springboot-critical-alerts
  namespace: monitoring
spec:
  groups:
    - name: springboot-alert-rules
      interval: 30s
      rules:
        - alert: HighCPUUsage
          expr: |
            (
              sum(rate(container_cpu_usage_seconds_total{namespace="default", pod=~".*"}[5m])) by (pod)
              /
              sum(kube_pod_container_resource_limits{namespace="default", resource="cpu"}) by (pod)
            ) * 100 > 70
          for: 5m
          labels:
            severity: warning
            component: spring-boot
          annotations:
            summary: "ğŸ”§ ë†’ì€ CPU ì‚¬ìš©ë¥  ê°ì§€"
            description: "Pod {{ $labels.pod }}ì˜ CPU ì‚¬ìš©ë¥ ì´ {{ $value | humanize }}%ì…ë‹ˆë‹¤. (ì„ê³„ê°’: 70%)"
        - alert: CriticalMemoryUsage
          expr: |
            (
              sum(container_memory_working_set_bytes{namespace="default"}) by (pod)
              /
              sum(kube_pod_container_resource_limits{namespace="default", resource="memory"}) by (pod)
            ) * 100 > 95
          for: 2m
          labels:
            severity: critical
            component: spring-boot
          annotations:
            summary: "ğŸš¨ ë©”ëª¨ë¦¬ ë¶€ì¡± ìœ„í—˜"
            description: "Pod {{ $labels.pod }}ì˜ ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ ì´ {{ $value | humanize }}%ì…ë‹ˆë‹¤. (ì„ê³„ê°’: 95%)"
        - alert: AppDown
          expr: up{job=~"spring-boot-.*"} == 0
          for: 2m
          labels:
            severity: critical
            component: spring-boot
          annotations:
            summary: "ğŸ”´ Spring Boot ì•± ì‘ë‹µ ì—†ìŒ"
            description: "{{ $labels.instance }} ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ì•±ì´ ì‘ë‹µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤ (up == 0)."
        - alert: PodRestartingTooOften
          expr: increase(kube_pod_container_status_restarts_total{namespace="default"}[1h]) > 3
          for: 5m
          labels:
            severity: warning
            component: spring-boot
          annotations:
            summary: "â™»ï¸ Pod ì¬ì‹œì‘ ë¹ˆë„ ë†’ìŒ"
            description: "Pod {{ $labels.pod }}ê°€ ìµœê·¼ 1ì‹œê°„ ë™ì•ˆ {{ $value }}íšŒ ì¬ì‹œì‘í–ˆìŠµë‹ˆë‹¤."
